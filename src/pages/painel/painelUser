import React, { useEffect, useState } from 'react';
import styles from '../styles/Home.module.css'; // Arquivo de estilos, pode ser adaptado conforme necessário

export default function Home() {
    const [transactions, setTransactions] = useState([]);
    const [accounts, setAccounts] = useState([]);
    const [entryTotal, setEntryTotal] = useState(0);
    const [exitTotal, setExitTotal] = useState(0);
    const [total, setTotal] = useState(0);

    useEffect(() => {
        fetchTransactions();
        fetchAccounts();
    }, []);

    const fetchTransactions = async () => {
        try {
            const response = await fetch('/api/transactions');
            if (response.ok) {
                const data = await response.json();
                setTransactions(data);
                updateTotals(data);
            } else {
                throw new Error('Erro ao buscar transações');
            }
        } catch (error) {
            console.error('Erro:', error);
        }
    };

    const fetchAccounts = async () => {
        try {
            const response = await fetch('/api/accounts');
            if (response.ok) {
                const data = await response.json();
                setAccounts(data);
            } else {
                throw new Error('Erro ao buscar contas bancárias');
            }
        } catch (error) {
            console.error('Erro:', error);
        }
    };

    const updateTotals = (transactions) => {
        let entrySum = 0;
        let exitSum = 0;

        transactions.forEach((transaction) => {
            if (transaction.type === 'entry') {
                entrySum += transaction.value;
            } else if (transaction.type === 'exit') {
                exitSum += transaction.value;
            }
        });

        setEntryTotal(entrySum);
        setExitTotal(exitSum);
        setTotal(entrySum - exitSum);
    };

    const handleTransactionSubmit = async () => {
        // Lógica para submissão de nova transação
    };

    const handleAccountSubmit = async () => {
        // Lógica para submissão de nova conta bancária
    };

    return (
        <div className={styles.container}>
            <div className={styles.controle}>
                <h2>CONTROLE FINANCEIRO PESSOAL</h2>
            </div>
            <div className={styles.buttons}>
                <button id="cadastroUsuarios" onClick={openModal}>
                    Cadastro de Usuários
                </button>
            </div>

            {/* Modal de Transações */}
            <div id="transactionModal" className="modal">
                <div className="modal-content">
                    <span className="close" onClick={closeTransactionModal}>
                        &times;
                    </span>
                    <h2>Últimas Transações</h2>
                    <ul id="lastTransactions">
                        {/* Renderizar últimas transações aqui */}
                    </ul>
                </div>
            </div>

            {/* Seção de Controle de Finanças */}
            <div className={styles.container2}>
                <h2>CONTROLE DE FINANÇAS</h2>
                <div className="summary-section">
                    <div className="summary-box">
                        <h3>Entrada</h3>
                        <p>R$ {entryTotal.toFixed(2)}</p>
                    </div>
                    <div className="summary-box">
                        <h3>Saída</h3>
                        <p>R$ {exitTotal.toFixed(2)}</p>
                    </div>
                    <div className="summary-box">
                        <h3>Total</h3>
                        <p>R$ {total.toFixed(2)}</p>
                    </div>
                </div>

                {/* Formulário de Nova Transação */}
                <div className="entry-section">
                    <h3>Nova transação</h3>
                    <div className="entry-form">
                        <input
                            type="text"
                            id="description"
                            placeholder="Descrição"
                            required
                        />
                        <input
                            type="text"
                            id="value"
                            placeholder="Valor"
                            required
                        />
                        <input
                            type="text"
                            id="date"
                            placeholder="Data (DD/MM/YYYY)"
                            required
                        />
                        <select id="type">
                            <option value="entry">Entrada</option>
                            <option value="exit">Saída</option>
                        </select>
                        <button onClick={handleTransactionSubmit}>
                            Incluir
                        </button>
                    </div>
                </div>
            </div>

            {/* Modal de Usuários */}
            <div id="userModal" className="modal">
                <div className="modal-content">
                    <span className="close" onClick={closeModal}>
                        &times;
                    </span>
                    <h2>Lista de Usuários</h2>
                    <ul id="userList">{/* Renderizar lista de usuários aqui */}</ul>
                </div>
            </div>

            {/* Tabela de Transações */}
            <div className={styles.container2}>
                <table className="transaction-table">
                    <thead>
                        <tr>
                            <th>Descrição</th>
                            <th>Valor</th>
                            <th>Tipo</th>
                            <th>Data</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="transactionBody">
                        {/* Renderizar corpo da tabela de transações aqui */}
                    </tbody>
                </table>
            </div>

            {/* Formulário de Nova Conta Bancária */}
            <div className={styles.container2}>
                <h2>CADASTRO DE CONTAS BANCÁRIAS</h2>
                <div className="entry-section">
                    <h3>Nova Conta Bancária</h3>
                    <div className="entry-form">
                        <input
                            type="text"
                            id="accountName"
                            placeholder="Nome da Conta"
                            required
                        />
                        <input
                            type="text"
                            id="bank"
                            placeholder="Banco"
                            required
                        />
                        <input
                            type="text"
                            id="accountNumber"
                            placeholder="Número da Conta"
                            required
                        />
                        <input
                            type="text"
                            id="balance"
                            placeholder="Saldo"
                            required
                        />
                        <button onClick={handleAccountSubmit}>
                            Cadastrar Conta
                        </button>
                    </div>
                </div>
            </div>

            {/* Tabela de Contas Bancárias */}
            <div className={styles.container3}>
                <table className="account-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Banco</th>
                            <th>Número</th>
                            <th>Saldo</th>
                        </tr>
                    </thead>
                    <tbody id="accountBody">
                        {/* Renderizar corpo da tabela de contas bancárias aqui */}
                    </tbody>
                </table>
            </div>
        </div>
    );
}
